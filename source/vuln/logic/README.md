
# 业务逻辑漏洞

由于程序逻辑不严谨或逻辑太过复杂，导致一些逻辑分支不能正常处理或处理错误，统称为业务逻辑漏洞。常见的逻辑漏洞有交易支付、密码修改、密码找回、越权修改、越权查询、突破限制等。

## 身份认证安全

- 账号枚举

- 暴力破解
  - 在没有验证码限制或者一次验证码可以多次使用的地方，使用已知用户对密码进行暴力破解或者用一个通用密码对用户进行暴力破解

- cookie & session
  - 敏感信息泄露
  - 伪造: 修改cookie中的某个参数可以登录其他用户
  - 猜测/爆破
  - session fixation

- 弱加密
  - 加密解密测试
  - 明文传输

- 登陆认证绕过

## 业务一致性安全

- 手机号篡改
- 邮箱或者用户名篡改
- 订单id篡改
- 商品id篡改
- 用户id篡改

## 业务数据篡改

- 支付金额数据篡改
- 商品数量篡改
- 最大数量限制
- 前端限制绕过

## 用户输入合规性

- 注入测试
- XSS测试
- fuzz(模糊测试)

## 密码找回漏洞

- 重置任意用户密码
- 密码充值后新密码在返回包中
- token验证逻辑在前端
- 密码修改邮件或手机号可篡改

## 验证码突破

- 验证码可重用
- 验证码可预测
- 验证码强度不够
- 验证码无时间限制或者失效时间长
- 验证码无猜测次数限制
- 验证码传递特殊的参数或不传递参数绕过
- 验证码可从返回包中直接获取
- 验证码不刷新或无效
- 验证码数量有限
- 验证码在数据包中返回
- 修改Cookie绕过
- 修改返回包绕过
- 验证码在客户端生成或校验
- 验证码可OCR或使用机器学习识别
- 验证码用于手机短信/邮箱轰炸

## 业务授权安全

越权漏洞的成因主要是因为开发人员在对数据进行增、删、改、查询时对客户端请求的数据过分相信而遗漏了权限的判定

- 未授权访问
- 越权测试
  - 垂直越权 (垂直越权是指使用权限低的用户可以访问权限较高的用户)
  - 平行越权 (水平越权是指相同权限的不同用户可以互相访问)
  - 交叉越权

## 业务流程乱序

- 顺序执行缺陷
  - 如某订单生成后流程走到的链接中，只需要提供对应的充值订单号就可以绕过支付环节，未经支付直接充值成功
  - 如进密码找回时跳过2fa验证找回密码成功

## 业务接口调用安全

- 重放攻击
- 恶意注册
- 短信或邮件炸弹
- 内容编辑
  - 抓包修改发送给用户的信息或邮件, 达到欺骗等等效果

## 时效绕过测试

- 时间刷新缺陷
  - 12306网站的买票业务是每隔5s，票会刷新一次。但是这个时间确实在本地设置的间隔。于是，在控制台就可以将这个时间的关联变量重新设置成1s或者更小，这样刷新的时间就会大幅度缩短（主要更改autoSearchTime本地参数）。
- 时间范围测试
  - 针对某些带有时间限制的业务，修改其时间限制范围，例如在某项时间限制范围内查询的业务，修改含有时间明文字段的请求并提交，查看能否绕过时间限制完成业务流程。例如通过更改查询手机网厅的受理记录的month范围，可以突破默认只能查询六个月的记录


## 参考

- [逻辑漏洞归纳总结](http://sm0nk.com/2017/10/18/%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E%E5%BD%92%E7%BA%B3%E6%80%BB%E7%BB%93/)
- [乌云逻辑漏洞总结](https://wooyun.js.org/drops/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E5%BD%92%E7%BA%B3%E6%80%BB%E7%BB%93.html)